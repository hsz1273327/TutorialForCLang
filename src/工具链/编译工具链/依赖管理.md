# 依赖管理

C/C++的依赖管理算是非常凌乱的,在前面的文章中我们也算是大致介绍了下使用cmake管理依赖的方式.很明显这个方式痛点不少,还是比较繁琐复杂的.一旦一个项目依赖上十几二十个库那维护起来还是很酸爽的.同时如果第三方库大量使用源码安装会大大拖慢编译时间,造成大量的资源浪费.依赖大量托管在git仓库,http服务器上也会对编译的可维护性造成一定影响,同时对代码安全有要求的场景这种方式也很难管理维护.

我们期望的是可以有一个集中式的依赖仓库,类似pypi,它里面有大量常用库在各个常用平台上已经编译好的二进制包,同时也提供源码包以供在不常用的平台上也可以尝试安装.同时这个平台也提供一个客户端工具,类似pip,可以用于管理项目的依赖项,同时也支持将自己的库上传到仓库中统一管理,同时最好提供用户自行部署仓库的能力,以方便企业或者团体私人使用. C/C++有这样的工具么?答案是有,而且不止一个,但又不完全有.目前没有一个工具可以满足上面所有的期望,但又有两个候选的工具他们可以一定程度上满足上面的需求.他们就是`vcpkg`和`conan`,下面是它们以及各种linux发行版包管理工具对对比矩阵

| 特性\工具                      | linux发行版包管理仓库 | vcpkg | conan |
| ------------------------------ | --------------------- | ----- | ----- |
| 集中式管理                     | 是                    | 是    | 是    |
| 跨平台                         | 否                    | 是    | 是    |
| 常用平台提供二进制包           | 是                    | 否    | 是    |
| 保管库数量                     | 多                    | 多    | 少    |
| 支持自行部署仓库               | 否                    | 否    | 是    |
| 客户端工具用于查找安装卸载依赖 | 是                    | 是    | 是    |
| 客户端工具用于发布依赖         | 是                    | 是    | 是    |
| 客户端工具提供系统级依赖管理   | 是                    | 否    | 否    |
| 客户端工具提供项目级的依赖管理 | 否                    | 否    | 是    |

看起来conan更有优势,但架不住conan上的资源太少.好在这两个工具都可以无缝的和cmake结合使用,这样相当于我们可以使用cmake来管理项目,而不同的依赖管理工具则专门用于管理项目依赖.

## C/C++项目的依赖管理策略

任何情况下我们都希望我们编译项目不会影响系统,因此项目级的依赖管理才是我们应该采取的策略.

C/C++项目的依赖管理可以遵从如下规则进行:

1. 尽可能使用`conan`管理项目依赖
2. `conan`中找不到的包尽量使用vcpkg安装,同时尽量安装为静态包
3. 尽量不用linux发行版包管理工具管理依赖

## 针对可执行文件的项目管理

我们继续改造`helloworld_with_log`项目.这个项目依赖`spdlog`这个包而conan中刚好有.这里就借着这个项目介绍下如何使用conan构造可执行文件.

### 使用conan管理可执行文件项目的依赖

使用conan管理可执行文件项目的依赖只有两步

1. 项目根目录编写[conanfile.txt]()用于描述依赖
2. 创建`build`文件夹,进入后执行`conan install ..[]`




## 针对包的项目管理

### 使用conan管理包项目的依赖


## conan外挂vcpkg扩展可用包的上限