
# ç¼–è¯‘é…å¥—å·¥å…·

ä¹‹å‰çš„ä»£ç æˆ‘ä»¬ç›´æ¥ä½¿ç”¨gccæ¥æ‰‹å·¥ç¼–è¯‘,è¿™æ²¡é—®é¢˜,ä¸è¿‡æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†æ¯æ¬¡ç¼–è¯‘çš„å‘½ä»¤éƒ½æ¯”pythonçš„helloworldéƒ½é•¿äº†.åƒå¾ˆå¤šå¤æ‚çš„ç¨‹åºç”¨åˆ°å¾ˆå¤šå¤–éƒ¨ä¾èµ–çš„æƒ…å†µä¸‹ç¼–è¯‘éƒ½å¿«èµ¶ä¸Šå†™ä¸šåŠ¡é€»è¾‘äº†.

åœ¨jsä¸­æˆ‘ä»¬ç”¨glupæ¥æµç¨‹åŒ–ç¼–è¯‘,åœ¨cä¸­çš„æµç¨‹åŒ–ç¼–è¯‘å·¥å…·å°±å¤ªå¤šäº†,å„è‡ªé€‚ç”¨äºä¸åŒçš„å¹³å°æœ‰ç€ä¸åŒçš„è§„èŒƒ,è¿™è¾¹ä»‹ç»çš„æ˜¯[makefile](https://www.gnu.org/software/make/manual/make.html)å’Œ[cmake](https://cmake.org/)å·¥å…·.

makefileæ˜¯ç±»unixç³»ç»Ÿä¸‹ä¸€ä¸ªå¤è€çš„å·¥å…·,è‡³ä»Šæ´»è·ƒåœ¨ç¼–ç¨‹å±Š.

cmakeæ˜¯ä¸€ä¸ªé«˜å±‚æ¬¡çš„æµç¨‹åŒ–ç¼–è¯‘å·¥å…·,å®ƒå¯ä»¥ç”¨æ¥è‡ªåŠ¨ç”Ÿæˆmakefile,å…³é”®æ˜¯ä»–è·¨å¹³å°.

## makefileä¸è‡ªåŠ¨åŒ–ç¼–è¯‘

makeæ˜¯ä¸€ä¸ªlinux/osxä¸‹å¯ä»¥æ›¿ä½ è¿è¡Œç¼–è¯‘å‘½ä»¤çš„å·¥å…·.makeä¼šæ£€æŸ¥æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶çš„æ—¶é—´æˆ³,å¦‚æœç›®æ ‡æ–‡ä»¶è¿‡æœŸ,makeå°±ä¼šé‡æ–°ç¼–è¯‘å®ƒ.

åœ¨windowsä¸‹,åªæœ‰å®‰è£…äº†mingwæ‰ä¼šå®‰è£…makeå·¥å…·,å®ƒçš„åå­—å«åš`mingw32-make.exe`.ä¸ºäº†æ–¹ä¾¿èµ·è§å¯ä»¥å°†å…¶æ”¹åä¸º`make`

ä½†æ˜¯åšåˆ°æ‰€æœ‰è¿™äº›äº‹æƒ…å‰,éœ€è¦å‘Šè¯‰makeæºä»£ç çš„ä¸€äº›æƒ…å†µ.makeéœ€è¦çŸ¥é“æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»,åŒæ—¶è¿˜éœ€è¦å‘Šè¯‰å®ƒä½ å…·ä½“æƒ³å¦‚ä½•æ„å»ºä»£ç .ä¸¥æ ¼æ„ä¹‰ä¸Šè®²,makeä¸ä»…ä»…å¯ä»¥ç”¨æ¥ç¼–è¯‘æ–‡ä»¶.ç›®æ ‡å¯ä»¥æ˜¯ä»»ä½•ç”¨å…¶ä»–æ–‡ä»¶ç”Ÿæˆçš„æ–‡ä»¶,ä¹Ÿå°±æ˜¯è¯´ç›®æ ‡å¯ä»¥æ˜¯ä¸€æ‰¹æ–‡ä»¶å‹ç¼©è€Œæˆçš„å‹ç¼©æ–‡æ¡£.

å¯¹æ¯ä¸ªç›®æ ‡,makeéœ€è¦çŸ¥é“ä¸¤ä»¶äº‹:

+ ä¾èµ–é¡¹

    ç”Ÿæˆç›®æ ‡éœ€è¦ç”¨å“ªäº›æ–‡ä»¶
    
    
+ ç”Ÿæˆæ–¹æ³•

    ç”Ÿæˆè¯¥æ–‡ä»¶æ—¶è¦ç”¨å“ªäº›æŒ‡ä»¤
    
    
ä¾èµ–é¡¹å’Œç”Ÿæˆæ–¹æ³•åˆåœ¨ä¸€èµ·æ„æˆäº†ä¸€æ¡è§„åˆ™.æœ‰äº†è§„åˆ™,makeå°±çŸ¥é“å¦‚ä½•ç”Ÿæˆç›®æ ‡.

## ç”¨makefileå‘makeæè¿°ä»£ç 

æ‰€æœ‰ç›®æ ‡,ä¾èµ–é¡¹å’Œç”Ÿæˆæ–¹æ³•çš„ç»†èŠ‚ä¿¡æ¯éœ€è¦ä¿å­˜åœ¨ä¸€ä¸ªå«`makefile`æˆ–`Makefile`çš„æ–‡ä»¶ä¸­,

### makefileè¯­æ³•

makefileè§„åˆ™å¾ˆç®€å•,åŸºæœ¬çš„è§„åˆ™:

+ è§„åˆ™å½¢å¼

```makefile
target: require1 require2 require3
	process
```
æ³¨æ„processå‰é¢å¿…é¡»æ˜¯tab

+ å®šä¹‰ç¯å¢ƒå˜é‡

```makefile
export FLASK_ENV=dev
```
+ å®šä¹‰å˜é‡

```makefile
DIR=xxx
```

+ ä½¿ç”¨ç¯å¢ƒå˜é‡/å˜é‡

```makefile
$(pwd)
```

æ³¨æ„,è¦è·å–æ ‡å‡†è¾“å‡ºçš„å†…å®¹éœ€è¦ä½¿ç”¨`$(shell xxx)`

ä¸ºäº†å¼„æ˜ç™½å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„,ä¸‹é¢æˆ‘ä»¬è¿˜æ˜¯ä»¥`binary_vector`ä¸ºä¾‹ä¸ºå®ƒå†™ä¸ª`makefile`ç”¨ä»¥å®ç°ç¼–è¯‘é™æ€é“¾æ¥åº“å’Œæµ‹è¯•æ–‡ä»¶çš„åŠŸèƒ½:

+ `./code/compiler/S2/makefile`

```makefile
DIR = $(shell pwd)
INCLUDE_DIR = $(DIR)/source/inc
SRC_DIR = $(DIR)/source/src
OBJECT_DIR = $(DIR)/source/obj
LIB_DIR = $(DIR)/build/lib
BIN_DIR = $(DIR)/build/bin
TEST_DIR = $(DIR)/test

objects = $(addprefix $(OBJECT_DIR)/,binary_operator.o unary_operator.o struct_operator.o)

all: $(LIB_DIR)/libvector.a
	echo "done!"

$(OBJECT_DIR)/struct_operator.o: $(INCLUDE_DIR)/binary_vector.h
	gcc -c \
-o $(OBJECT_DIR)/struct_operator.o \
-I $(INCLUDE_DIR) \
$(SRC_DIR)/struct_operator.c    

$(OBJECT_DIR)/binary_operator.o: $(INCLUDE_DIR)/binary_vector.h
	gcc -c \
-o $(OBJECT_DIR)/binary_operator.o \
-I $(INCLUDE_DIR) \
$(SRC_DIR)/binary_operator.c
    
$(OBJECT_DIR)/unary_operator.o: $(INCLUDE_DIR)/binary_vector.h
	gcc -c \
-o $(OBJECT_DIR)/unary_operator.o \
-I $(INCLUDE_DIR) \
$(SRC_DIR)/unary_operator.c
    
$(LIB_DIR)/libvector.a: $(objects)
	ar crv $(LIB_DIR)/libvector.a \
$(objects)

$(BIN_DIR)/vectorTest: $(LIB_DIR)/libvector.a $(INCLUDE_DIR)/binary_vector.h $(TEST_DIR)/test.c
	gcc \
-o $(BIN_DIR)/vectorTest \
-I $(INCLUDE_DIR) \
-L $(LIB_DIR) \
-l vector \
$(TEST_DIR)/test.c

test: $(BIN_DIR)/vectorTest
	$(BIN_DIR)/vectorTest
    
clean: $(BIN_DIR)/vectorTest $(objects) $(LIB_DIR)/libvector.a
	rm $(BIN_DIR)/vectorTest $(objects) $(LIB_DIR)/libvector.a
```

éœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¡å‘½ä»¤éƒ¨åˆ†åªèƒ½ç”¨`/tab`è€Œä¸æ˜¯ç©ºæ ¼

### ä½¿ç”¨`make`å‘½ä»¤

makeå‘½ä»¤ä½¿ç”¨`-C`æŒ‡å®šæ“ä½œç›®å½•, åé¢æ¥`makefile`ä¸­çš„targetæ‰§è¡Œå®šä¹‰çš„è¿‡ç¨‹å’Œä¾èµ–.å¦‚æœä¸æŒ‡å®štargetåˆ™ä¼šçŸ¥åç¬¬ä¸€æ¡target

```bash
!make -C ./code/compiler/S2/ clean
```

```bash
gcc \
-o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/bin/vectorTest \
-I /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/inc \
-L /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/lib \
-l vector \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/test/test.c
rm /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/bin/vectorTest /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/binary_operator.o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/unary_operator.o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/struct_operator.o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/lib/libvector.a
```

```bash
!make -C ./code/compiler/S2/
```

```bash
gcc -c \
-o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/binary_operator.o \
-I /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/inc \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/src/binary_operator.c
gcc -c \
-o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/unary_operator.o \
-I /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/inc \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/src/unary_operator.c
gcc -c \
-o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/struct_operator.o \
-I /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/inc \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/src/struct_operator.c    
ar crv /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/lib/libvector.a \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/binary_operator.o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/unary_operator.o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/struct_operator.o
a - /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/binary_operator.o
a - /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/unary_operator.o
a - /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/obj/struct_operator.o
echo "done!"
done!
```

```bash
!make -C ./code/compiler/S2/ test
```

```bash
gcc \
-o /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/bin/vectorTest \
-I /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/source/inc \
-L /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/lib \
-l vector \
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/test/test.c
/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S2/build/bin/vectorTest
mod(A)=2.236068
mod(B)=5.000000
mul(A,B)=11.000000
add(A,B)=<4.000000,6.000000>
```

## ä½¿ç”¨cmakeæµç¨‹åŒ–ç¼–è¯‘

Cmakeæœ¬è´¨ä¸Šä¹Ÿä¸æä¾›æµç¨‹åŒ–ç¼–è¯‘çš„åŠŸèƒ½,ä»–å…¶å®æ˜¯ç”¨æ¥ç”Ÿæˆä¸åŒå¹³å°makeæ–‡ä»¶çš„,åœ¨linux,mac osxä¸Šå°±æ˜¯`makefile`,æ­£çœŸç¼–è¯‘ä½¿ç”¨`make`å‘½ä»¤,åœ¨windowsä¸Šå°±æ˜¯`nmake`å½“ç„¶windowsä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨`mingw`æ¥ç¼–è¯‘,è‡ªå¸¦çš„`mingwXX-make`æ¥ç¼–è¯‘makefile.ä¸è¿‡è¿™éœ€è¦åœ¨cmakeçš„æ—¶å€™åŠ ä¸Šé¢å¤–å‚æ•°`-G  "MinGW Makefiles"`æŒ‡å®š

### CmakeåŸºæœ¬ç”¨æ³•

Cmakeæ˜¯æŒ‡ä»¤å¼çš„é…ç½®æ–¹å¼,åŸºæœ¬å½¢å¼å°±æ˜¯`cmake_minimum_required (VERSION 2.8)`è¿™æ ·,`()`å¤–é¢çš„æ˜¯å‚æ•°å­—æ®µ,é‡Œé¢çš„æ˜¯å†…å®¹.

#### å¸¸ç”¨çš„å­—æ®µæœ‰:

> å…ƒä¿¡æ¯è®¾ç½®

+ `cmake_minimum_required`ï¼šæŒ‡å®šè¿è¡Œæ­¤é…ç½®æ–‡ä»¶æ‰€éœ€çš„ CMake çš„æœ€ä½ç‰ˆæœ¬

+ `project(<proname>)`ï¼šå‚æ•°å€¼æ˜¯ Demo1ï¼Œè¯¥å‘½ä»¤æŒ‡å®šé¡¹ç›®çš„åç§°

> ç¼–è¯‘å™¨è®¾ç½®

+ `set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/Lib)`:è®¾ç½®é™æ€è¿æ¥æ–‡ä»¶è¾“å‡ºç›®å½•
+ `set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/Lib)`:è®¾ç½®åŠ¨æ€æ€è¿æ¥æ–‡ä»¶è¾“å‡ºç›®å½•
+ `set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/Bin)`:è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•
+ `set_target_properties(<projectnam> PROPERTIES PUBLIC_HEADER "some.h;headers.h")` å°†å¯¹å¤–çš„æ¥å£å¤´æ–‡ä»¶è®¾ç½®åˆ°ç¼–è¯‘ç›®æ ‡ä¸Š
+ `include_directories([AFTER|BEFORE] [SYSTEM] dir1 [dir2 ...])`:è®¾ç½®å¤´æ–‡ä»¶ç›®å½•
+ `link_directories(directory1 directory2 ...)`:è®¾ç½®è¿æ¥åº“æ‰€åœ¨ä½ç½®
+ `link_libraries(library1 <debug | optimized> library2 ...)`:æ·»åŠ éœ€è¦é“¾æ¥çš„åº“æ–‡ä»¶è·¯å¾„
+ `target_link_libraries(<target> [item1 [item2 [...]]][[debug|optimized|general] <item>] ...)`:è®¾ç½®è¦é“¾æ¥çš„åº“æ–‡ä»¶çš„åç§°
+ `aux_source_directory(<dir> <variable>)`: æŒ‡å®šæºæ–‡ä»¶çš„æ‰€åœ¨ç›®å½•,å¦‚`aux_source_directory(. DIR_SRCS)`è¿™æ ·å°±å°†æ‰€æœ‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åæ”¾åˆ°äº†`DIR_SRCS`å˜é‡ä¸­.`add_executable(Demo ${DIR_SRCS})`å°±æŒ‡å®šå¥½äº†æ‰€æœ‰æ–‡ä»¶.

+ `add_executable(<target> <sourcefiles...>)`ï¼š å°†æºæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶,ç¬¬ä¸€ä½æ˜¯ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶å,åé¢åˆ™æ˜¯æºæ–‡ä»¶å.

+ add_compile_options(-std=c++11):æŒ‡å®šç¼–è¯‘ç›®æ ‡ä½¿ç”¨çš„é¢å¤–å‚æ•°,æ¯”å¦‚æ”¯æŒc++11

+ target_compile_features(<target> <features...>)æŒ‡å®šç¼–è¯‘ç›®æ ‡ä½¿ç”¨çš„é¢å¤–å‚æ•°

> é“¾æ¥ç¼–è¯‘è®¾ç½®

+ `add_library (<target> [type]<sourcefiles...>)`:å°†æºæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªé“¾æ¥åº“.


> å­ç›®å½•è®¾ç½®

+ `add_subdirectory(math)`:æ·»åŠ å­ç›®å½•,å­ç›®å½•ä¸­éœ€è¦æœ‰`CMakeLists.txt`æ–‡ä»¶,ç¼–è¯‘æ—¶ä¼šä¼˜å…ˆç¼–è¯‘å­ç›®å½•.

> æµ‹è¯•è®¾ç½®

å¯ä»¥ç”¨`make test`æ‰§è¡Œæµ‹è¯•

+ `enable_testing()`:å¯åŠ¨æµ‹è¯•
+ `add_test(<æµ‹è¯•å> <test_target> <args>)`:æ·»åŠ ä¸€ä¸ªæµ‹è¯•,éœ€è¦å…ˆæŠŠæµ‹è¯•ä»£ç ç¼–è¯‘äº†
+ `set_tests_properties (test_usage PROPERTIES PASS_REGULAR_EXPRESSION "Usage: .* base exponent")`è®¾å®šæµ‹è¯•çš„å±æ€§


+ å®šä¹‰ä¸€ä¸ªå®ï¼Œç”¨æ¥ç®€åŒ–æµ‹è¯•å·¥ä½œ

```cmake
macro (do_test arg1 arg2 result)
  add_test (test_${arg1}_${arg2} Demo ${arg1} ${arg2})
  set_tests_properties (test_${arg1}_${arg2}
    PROPERTIES PASS_REGULAR_EXPRESSION ${result})
endmacro (do_test)
```

> debugæµ‹è¯•

```cmake
set(CMAKE_BUILD_TYPE "Debug")
set(CMAKE_CXX_FLAGS_DEBUG "$ENV{CXXFLAGS} -O0 -Wall -g -ggdb")
set(CMAKE_CXX_FLAGS_RELEASE "$ENV{CXXFLAGS} -O3 -Wall")
```

> installåŠŸèƒ½

é€šå¸¸å¯ä»¥æ˜¯è¿™æ ·çš„å®šä¹‰

```cmake
install([TARGETS <name>...(ç¼–è¯‘ç›®æ ‡)|FILES <file>...(è¦ç§»åŠ¨çš„æ–‡ä»¶)]
    [LIBRARY(åŠ¨æ€åº“)|ARCHIVE(é™æ€åº“)|RUNTIME(å¯æ‰§è¡Œæ–‡ä»¶)] DESTINATION  <dir> ...
    [INCLUDES DESTINATION [<dir> ...]]
)  
```

#### cmake çš„è¯­æ³•æœ‰:

+ æ‰“å°ä¿¡æ¯

    `MESSAGE([SEND_ERROR | STATUS | FATAL_ERROR] "message to display"...)`,å¦‚:`MESSAGE(STATUS "This is BINARY dir " ${HELLO_BINARY_DIR}))`

+ æŒ‡å®šç¼–è¯‘å™¨:

    `SET(CMAKE_C_COMPILER "/home/public/local/bin/gcc")`

    `SET(CMAKE_CXX_COMPILER "/home/public/local/bin/g++")`

+ æ˜¾å¼çš„è®¾ç½®è‡ªå®šä¹‰å˜é‡

    ä½¿ç”¨`set(å˜é‡å å€¼)`çš„æ“ä½œï¼Œå¦‚:`SET(HELLO_SRC main.SOURCE_PATHc)`
    
+ å˜é‡å¼•ç”¨çš„æ–¹å¼

    ä½¿ç”¨`${}`è¿›è¡Œå˜é‡çš„å¼•ç”¨
    
+ è®¾ç½®ç¯å¢ƒå˜é‡

    `SET(ENV{å˜é‡å} å€¼)`
    
+ è°ƒç”¨ç¯å¢ƒå˜é‡

    ä½¿ç”¨`$ENV{NAME}`æŒ‡ä»¤å°±å¯ä»¥è°ƒç”¨ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡äº†
    
    
+ IF æŒ‡ä»¤

   åŸºæœ¬è¯­æ³•ä¸º:
   ```
   IF(expression_r_r)
     # THEN section.
     COMMAND1(ARGS ...)
     COMMAND2(ARGS ...)
     ...
   ELSE(expression_r_r)
     # ELSE section.
     COMMAND1(ARGS ...)
     COMMAND2(ARGS ...)
     ...
   ENDIF(expression_r_r)
   ```
   
+ WHILEæŒ‡ä»¤

   åŸºæœ¬è¯­æ³•ä¸º:
   ```
    WHILE(condition)
      COMMAND1(ARGS ...)
      COMMAND2(ARGS ...)
      ...
    ENDWHILE(condition)
   ```
å…¶çœŸå‡åˆ¤æ–­æ¡ä»¶å¯ä»¥å‚è€ƒ IF æŒ‡ä»¤ã€‚
    
    
+ FOREACH

    FOREACH æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§å½¢å¼:
    1. åˆ—è¡¨
    ```
    FOREACH(loop_var arg1 arg2 ...)
      COMMAND1(ARGS ...)
      COMMAND2(ARGS ...)
      ...
    ENDFOREACH(loop_var)
    ```
    2. èŒƒå›´(ç±»ä¼¼pythonzä¸­çš„for xxx in range(x))
    ```
    FOREACH(loop_var RANGE oop_var RANGE start stop [step])
    ENDFOREACH(loop_var)
    ```

#### Cmakeçš„é¢„å®šä¹‰å˜é‡æœ‰:

+ `CMAKE_BINARY_DIR/PROJECT_BINARY_DIR/<projectname>_BINARY_DIR`

    è¿™ä¸‰ä¸ªå˜é‡æŒ‡ä»£çš„å†…å®¹æ˜¯ä¸€è‡´çš„,å¦‚æœæ˜¯`in source`ç¼–è¯‘,æŒ‡å¾—å°±æ˜¯å·¥ç¨‹é¡¶å±‚ç›®å½•,å¦‚æœæ˜¯`out-of-source`ç¼–è¯‘,æŒ‡çš„æ˜¯å·¥ç¨‹ç¼–è¯‘å‘ç”Ÿçš„ç›®å½•
    PROJECT_BINARY_DIR è·Ÿå…¶ä»–æŒ‡ä»¤ç¨æœ‰åŒºåˆ«,ä½†å¤šæ•°æ—¶å€™ä½ å¯ä»¥ç†è§£ä¸ºä»–ä»¬æ˜¯ä¸€è‡´çš„.
    
    
+ `CMAKE_SOURCE_DIR/PROJECT_SOURCE_DIR/<projectname>_SOURCE_DIR`

    è¿™ä¸‰ä¸ªå˜é‡æŒ‡ä»£çš„å†…å®¹æ˜¯ä¸€è‡´çš„,ä¸è®ºé‡‡ç”¨ä½•ç§ç¼–è¯‘æ–¹å¼,éƒ½æ˜¯å·¥ç¨‹é¡¶å±‚ç›®å½•.ä¹Ÿå°±æ˜¯åœ¨`in source`ç¼–è¯‘æ—¶,ä»–è·Ÿ`CMAKE_BINARY_DIR`ç­‰å˜é‡ä¸€è‡´.`PROJECT_SOURCE_DIR`è·Ÿå…¶ä»–æŒ‡ä»¤ç¨æœ‰åŒºåˆ«,ä½†å¤šæ•°æ—¶å€™ä½ å¯ä»¥ç†è§£ä¸ºä»–ä»¬æ˜¯ä¸€è‡´çš„.

+ `CMAKE_CURRENT_SOURCE_DIR`

    æŒ‡çš„æ˜¯å½“å‰å¤„ç†çš„`CMakeLists.txt`æ‰€åœ¨çš„è·¯å¾„

+ `CMAKE_CURRRENT_BINARY_DIR`

    å¦‚æœæ˜¯`in-source`ç¼–è¯‘,å®ƒè·Ÿ`CMAKE_CURRENT_SOURCE_DIR`ä¸€è‡´,å¦‚æœæ˜¯`out-of-source`ç¼–è¯‘,ä»–æŒ‡çš„æ˜¯`target`ç¼–è¯‘ç›®å½•.ä½¿ç”¨`ADD_SUBDIRECTORY(src bin)`å¯ä»¥æ›´æ”¹è¿™ä¸ªå˜é‡çš„å€¼.ä½¿ç”¨`SET(EXECUTABLE_OUTPUT_PATH <æ–°è·¯å¾„>)`å¹¶ä¸ä¼šå¯¹è¿™ä¸ªå˜é‡é€ æˆå½±å“,å®ƒä»…ä»…ä¿®æ”¹äº†æœ€ç»ˆç›®æ ‡æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„.

+ `CMAKE_CURRENT_LIST_FILE`

    è¾“å‡ºè°ƒç”¨è¿™ä¸ªå˜é‡çš„`CMakeLists.txt`çš„å®Œæ•´è·¯å¾„

 
+ `CMAKE_CURRENT_LIST_LINE`

    è¾“å‡ºè¿™ä¸ªå˜é‡æ‰€åœ¨çš„è¡Œ

+ CMAKE_MODULE_PATH

    è¿™ä¸ªå˜é‡ç”¨æ¥å®šä¹‰è‡ªå·±çš„`cmake`æ¨¡å—æ‰€åœ¨çš„è·¯å¾„.å¦‚æœä½ çš„å·¥ç¨‹æ¯”è¾ƒå¤æ‚,æœ‰å¯èƒ½ä¼šè‡ªå·±ç¼–å†™ä¸€äº›`cmake`æ¨¡å—,è¿™äº›`cmake`æ¨¡å—æ˜¯éšä½ çš„å·¥ç¨‹å‘å¸ƒçš„,ä¸ºäº†è®© `cmake`åœ¨å¤„ç†`CMakeLists.txt`æ—¶æ‰¾åˆ°è¿™äº›æ¨¡å—,ä½ éœ€è¦é€šè¿‡`SET`æŒ‡ä»¤,å°†è‡ªå·±çš„`cmake`æ¨¡å—è·¯å¾„è®¾ç½®ä¸€ä¸‹.æ¯”å¦‚`SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)`.è¿™æ—¶å€™ä½ å°±å¯ä»¥é€šè¿‡ INCLUDE æŒ‡ä»¤æ¥è°ƒç”¨è‡ªå·±çš„æ¨¡å—äº†.


+ `EXECUTABLE_OUTPUT_PATH /LIBRARY_OUTPUT_PATH`

    åˆ†åˆ«ç”¨æ¥é‡æ–°å®šä¹‰æœ€ç»ˆç»“æœçš„å­˜æ”¾ç›®å½•,å‰é¢æˆ‘ä»¬å·²ç»æåˆ°äº†è¿™ä¸¤ä¸ªå˜é‡ã€‚

+ `PROJECT_NAME`

    è¿”å›é€šè¿‡`PROJECT`æŒ‡ä»¤å®šä¹‰çš„é¡¹ç›®åç§°.


+ `CMAKE_MAJOR_VERSION,CMAKE`

    ä¸»ç‰ˆæœ¬å·,æ¯”å¦‚ 2.4.6 ä¸­çš„ 2
    
    
+ `CMAKE_MINOR_VERSION,CMAKE`

    æ¬¡ç‰ˆæœ¬å·,æ¯”å¦‚ 2.4.6 ä¸­çš„ 4
    
    
+ `CMAKE_PATCH_VERSION,CMAKE`

    è¡¥ä¸ç­‰çº§,æ¯”å¦‚ 2.4.6 ä¸­çš„ 6
    

+ `CMAKE_SYSTEM`

    ç³»ç»Ÿåç§°,æ¯”å¦‚ Linux-2.6.22
    
    
+ `CMAKE_SYSTEM_NAME`

    ä¸åŒ…å«ç‰ˆæœ¬çš„ç³»ç»Ÿå,æ¯”å¦‚ Linux
    
    
+ `CMAKE_SYSTEM_VERSION`

    ç³»ç»Ÿç‰ˆæœ¬,æ¯”å¦‚ 2.6.22
    
    
+ `CMAKE_SYSTEM_PROCESSOR`

    å¤„ç†å™¨åç§°,æ¯”å¦‚ i686.
    
    
+ `UNIX`

    åœ¨æ‰€æœ‰çš„ç±» UNIX å¹³å°ä¸º TRUE,åŒ…æ‹¬ OS X å’Œ cygwin
    
+ `WIN32`

    åœ¨æ‰€æœ‰çš„ win32 å¹³å°ä¸º TRUE,åŒ…æ‹¬ cygwin
    
+ `CMAKE_INSTALL_PREFIX`

    åœ¨cmakeç”Ÿæˆmakefileæ—¶ä½¿ç”¨`-D`æŒ‡å®šçš„ç›®å½•,ç”¨äºæŒ‡å®šå®‰è£…ç›®å½•,å¦‚æœä¸æŒ‡å®šä¸”å®‰è£…çš„åœ°å€æ˜¯ç›¸å¯¹åœ°å€,å°±ä¼šé»˜è®¤å®‰è£…åˆ°`/usr/local/`ä¸‹.

### ä½¿ç”¨cmakeç¼–è¯‘æˆ‘ä»¬çš„äºŒå…ƒå‘é‡

æ›´å¤šçš„ç”¨æ³•å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£.æœ¬æ–‡ä¸ä¼šå™è¿°å¤ªå¤š.é’ˆå¯¹æˆ‘ä»¬çš„äºŒå…ƒå‘é‡æ¨¡å—,æˆ‘ä»¬éœ€è¦å†™ä¸¤ä¸ª`CMakeLists.txt`,ä¸€ä¸ªç”¨äºå°†srcä¸­çš„å†…å®¹ç¼–è¯‘ä¸ºé™æ€åº“,ä¸€ä¸ªç”¨äºç¼–è¯‘æµ‹è¯•æ–‡ä»¶.

æˆ‘ä»¬å…ˆå°†S2ä¸­çš„ä»£ç å¤åˆ¶åˆ°S3

+ `./code/compiler/S3/CMakeLists.txt`
```cmake

#é¡¹ç›®ç¼–è¯‘ç¯å¢ƒ
cmake_minimum_required (VERSION 2.8)
project (binary_vector)
include_directories(source/inc)
# ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/lib)
aux_source_directory(${CMAKE_BINARY_DIR}/source/src DIR_LIB_SRCS)
add_library(vector SHARED ${DIR_LIB_SRCS})
install(TARGETS   vector
    LIBRARY DESTINATION  CMAKE_LIBRARY_OUTPUT_DIRECTORY  
)  
# ç¼–è¯‘è¿æ¥ç”Ÿæˆdemo
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/bin)
link_directories(${CMAKE_BINARY_DIR}/build/lib)
link_libraries(vector)
aux_source_directory(test DIR_SRCS)
add_executable(Demo ${DIR_SRCS})
#æµ‹è¯•
enable_testing()
add_test (DemoRuns ${CMAKE_BINARY_DIR}/build/bin/Demo)
```

æ‰§è¡Œcmake
```bash
cmake ./code/compiler/S3/CMakeLists.txt
```

ç»“æœä¼šè¾“å‡º
```
    -- Configuring done
    CMake Warning (dev):
      Policy CMP0042 is not set: MACOSX_RPATH is enabled by default.  Run "cmake
      --help-policy CMP0042" for policy details.  Use the cmake_policy command to
      set the policy and suppress this warning.
    
      MACOSX_RPATH is not specified for the following targets:
    
       vector
    
    This warning is for project developers.  Use -Wno-dev to suppress it.
    
    -- Generating done
    -- Build files have been written to: /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S3
```

cmakeä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´å¥½çš„makefile

```bash
!make -C ./code/compiler/S3/
```

```txt
    [ 66%] Built target vector
    [ 83%] [32mBuilding C object CMakeFiles/Demo.dir/test/test.c.o[0m
    [100%] [32m[1mLinking C executable build/bin/Demo[0m
    [100%] Built target Demo
```


```bash
!make -C ./code/compiler/S3/ test
```

```txt
    [36mRunning tests...[0m
    Test project /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/compiler/S3
        Start 1: DemoRuns
    1/1 Test #1: DemoRuns .........................   Passed    0.01 sec
    
    [0;32m100% tests passed[0;0m, 0 tests failed[0;0m out of 1
    
    Total Test time (real) =   0.02 sec
```
