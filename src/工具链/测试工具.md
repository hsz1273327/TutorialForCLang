
# 测试工具

C/C++的单元测试框架非常多,此处我只介绍2种,他们的特点都是只有头文件,因此都没有侵入性.

## 针对简单单元测试

针对简单单元测试我们可以使用一个叫[minunit](https://github.com/siu/minunit)的工具.这个工具C和C++都可以使用,非常轻量,适合针对简单接口.

我们依然使用之前的`vector`项目作为例子

我们将其下载到`/test`文件夹下,修改`test.c`文件:

+ `/test.c`

    ```c
    #include "minunit.h"
    #include "binary_vector.h"

    struct BINARY_VECTOR A = {1.0,2.0},B = {3.0,4.0};

    MU_TEST(test_check_modA) {
        mu_check(VEC_mod(&A) == 2.236068);
    }
    MU_TEST(test_check_modB) {
        mu_check(VEC_mod(&B) == 5.000000);
    }
    MU_TEST(test_check_mulA_B) {
        mu_check(VEC_mul(&A,&B) == 11.000000);
    }
    MU_TEST(test_check_addA_B) {
        BINARY_VECTOR_P result = VEC_add(&A,&B);
        mu_check(result->x == 4.000000);
        mu_check(result->y == 6.000000);
    }
    MU_TEST_SUITE(test_suite) {
        MU_RUN_TEST(test_check_modA);
        MU_RUN_TEST(test_check_modB);
        MU_RUN_TEST(test_check_mulA_B);
        MU_RUN_TEST(test_check_addA_B);
    }

    int main(int argc, char *argv[]) {
        MU_RUN_SUITE(test_suite);
        MU_REPORT();
        return 0;
    }
    ```

    这个测试框架大量使用宏,其中用到的宏有:

    + `MU_TEST` 这个宏用于声明测试过程
    + `MU_TEST_SUITE` 这个宏用于声明一个测试组
    + `mu_check`用于校验结果,类似python种的`assert`
    + `MU_RUN_TEST`执行指定的测试
    + `MU_RUN_SUITE`执行指定的测试组
    + `MU_REPORT()`打印结果

+ 执行`cmake .`后执行`make test`我们就可以获得到测试用的可执行文件,之后执行它

```bash
./build/test/vectorTest
```

我们就可以看到输出的报告了.

```txt
F
test_check_modA failed:
    /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/test_tool/test/test.c:7: VEC_mod(&A) == 2.236068
....

4 tests, 5 assertions, 1 failures

Finished in 0.00013472 seconds (real) 0.00006700 seconds (proc)
```  

## 测试复杂些的c++项目

测试复杂些的c++项目我们可以使用[Catch](https://github.com/catchorg/Catch2).这个库依然只有头文件.但它除了支持上面TDD风格的测试写法外也支持BDD风格的写法.

由于Catch只支持c++我们先将程序改成c++风格