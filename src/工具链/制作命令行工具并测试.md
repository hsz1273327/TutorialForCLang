
# åˆ¶ä½œå‘½ä»¤è¡Œå·¥å…·å¹¶æµ‹è¯•


Cè¯­è¨€æ˜¯å’Œç³»ç»Ÿæœ€è¿‘çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€,è€Œå¾ˆå¤šç³»ç»Ÿå·¥å…·ä¹Ÿæ˜¯Cå†™çš„.


## åˆ¶ä½œå°å·¥å…·


åœ¨linuxçš„ä¸–ç•Œé‡Œ,å¾ˆå¤šå·¥ä½œéƒ½æ˜¯ç”±å°å·¥å…·å®Œæˆçš„,å®ƒææ€•æ˜¯ç°å¦‚ä»Šæµè¡Œçš„`å¾®æœåŠ¡`æ¶æ„æœ€æ—©çš„å®è·µäº†.

æ‰€è°“å°å·¥å…·æœ‰è¿™æ ·çš„ç‰¹ç‚¹:

1. ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®
2. åœ¨æ ‡å‡†è¾“å‡ºæ˜¾ç¤ºæ•°æ®
3. å¤„ç†æ–‡æœ¬æ•°æ®ï¼Œè€Œä¸æ˜¯éš¾ä»¥é˜…è¯»çš„äºŒè¿›åˆ¶æ ¼å¼
4. åªåšä¸€ä»¶ç®€å•çš„äº‹

é€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºå¯ä»¥æ–¹ä¾¿çš„åšé‡å®šå‘,è€Œæ–‡æœ¬æ•°æ®é™¤äº†æœºå™¨å¥½è¯»,äººä¹Ÿå¥½è¯».


æ‰€è°“é‡æ–°å®šå‘æ˜¯æŒ‡ä½¿ç”¨`>`,`>>`ä½œä¸ºè¾“å‡º,ä½¿ç”¨`<`,`<<`ä½œä¸ºè¾“å…¥


æ¯”è¾ƒè®©äººç†ŸçŸ¥çš„å°±æ˜¯`grep`å°å·¥å…·äº†,å®ƒçš„ä½œç”¨æ˜¯è¿‡æ»¤æ‰æ–‡æœ¬ä¸­ä¸å«å…³é”®å­—çš„è¡Œ.è€Œä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯æ‹¿ä»–å’Œå…¶ä»–å·¥å…·é…åˆä½¿ç”¨çš„,æ¯”å¦‚æˆ‘å¸Œæœ›æŸ¥çœ‹ä¹‹å‰ä½¿ç”¨è¿‡çš„å¸¦`python`çš„å†å²è®°å½•,é‚£å°±å¯ä»¥è¿™æ ·å†™:

```shell
history | grep python
```

å½“ç„¶äº†å…¶ä»–è¯­è¨€æ¯”å¦‚pythonä¹Ÿå¯ä»¥åˆ¶ä½œå°å·¥å…·,è€Œä¸”ç”±äºè¯­æ³•æ›´åŠ ç®€å•,æŠ½è±¡å±‚æ¬¡æ›´é«˜,å®é™…ä¸Šå†™èµ·æ¥ä¼šæ›´åŠ ç®€å•,ä½†åœ¨è¿™è¾¹ç”¨c/c++æ¥åšå°å·¥å…·æœ‰å…¶åˆç†çš„ä¸€é¢

1. ä¸ç”¨ä¾èµ–ç¯å¢ƒ

    c/c++ä¸ä¾èµ–äºè¿è¡Œç¯å¢ƒ,åªè¦ç¼–è¯‘é€šè¿‡äº†å°±å¯ä»¥è¿è¡ŒäºŒè¿›åˆ¶ä»£ç .è€Œå¸¦æœ‰vmçš„è¯­è¨€æ¯”å¦‚java,python,è„±ç¦»äº†vmå°±æ— æ³•è¿è¡Œäº†
    
2. é«˜æ•ˆ

    å¤šæ•°æƒ…å†µä¸‹,,ç›¸åŒçš„é€»è¾‘,C/C++åˆ¶ä½œçš„å·¥å…·æœ‰æœ€é«˜çš„è¿è¡Œæ•ˆç‡
    
3. å°å·§

    åƒgoè¯­è¨€,ä¹Ÿæ˜¯ç¼–è¯‘æˆäºŒè¿›åˆ¶åæ‰§è¡Œçš„è¯­è¨€,ä½†ç”±äºå…¶æŠ½è±¡å±‚æ¬¡æ›´é«˜(è™½ç„¶ä¹Ÿæ²¡é«˜å¤šå°‘)è€Œä¸”æœ‰ä¸ªè¿è¡Œæ—¶,ç”Ÿæˆçš„ä»£ç æ¯”ä½¿ç”¨c/c++å†™çš„å¤§å¾—å¤š,è€Œc++å¦‚æœä½¿ç”¨æ¨¡æ¿çš„è¯ä¹Ÿä¼šæ¯”Cå†™çš„å¤§å¾—å¤š

## ä»ä¸€ä¸ªä¾‹å­å¼€å§‹

æˆ‘ä»¬æ¥å†™ä¸€ä¸ªgpsæ•°æ®æ ¼å¼è½¬æ¢å·¥å…·,ä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥å°†gpsæ•°æ®è½¬åŒ–ä¸ºç¬¦åˆè§„å®šçš„jsonæ ¼å¼,gpsæ•°æ®æ˜¯å½¢å¦‚:

```
42.363400,-71.098465,Speed = 21
42.363400,-71.097588,Speed = 23
42.363400,-71.098465,Speed = 27
.
.
.
```
çš„csvæ•°æ®

è€Œåœ°å›¾åº”ç”¨éœ€è¦çš„æ ¼å¼åˆ™å½¢å¦‚:

```json
data = [
{latitude: 42.363400, longitude: -71.098465, info: 'Speed = 21'},
.
.
.
]
```
çš„jsonæ•°æ®



å¥½,å¼€å§‹æˆ‘ä»¬çš„å°ç¨‹åº:

+ `./code/create_cmdline_tool/geo2json/source/src/geo2json.c`

    ```c
    #include <stdio.h>

    int main(){
        float latitude;
        float longitude;
        char info[80];
        int started = 0;
        puts("data=[");
        while (scanf("%f,%f,%79[^\n]",&latitude,&longitude,&info) == 3){
            if (started){
                printf(",\n");
            } else {
                started = 1;
            }
            printf("{latitude: %f, longitude: %f, info: '%s'}",latitude,longitude,info);
        }
        puts("\n]");
        return 0;
    }
    ```

+ `./code/create_cmdline_tool/geo2json/CMakeLists.txt`

    ```cmake
    #é¡¹ç›®ç¼–è¯‘ç¯å¢ƒ
    cmake_minimum_required (VERSION 2.8)
    project (geo2json)

    # ç¼–è¯‘è¿æ¥ç”Ÿæˆdemo
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/bin)
    aux_source_directory(${CMAKE_BINARY_DIR}/source/src DIR_SRCS)
    add_executable(geo2json ${DIR_SRCS})
    ```

æ‰§è¡Œcmake

```bash
cmake ./code/create_cmdline_tool/geo2json/CMakeLists.txt
```

```txt
-- The C compiler identification is AppleClang 10.0.0.10001044
-- The CXX compiler identification is AppleClang 10.0.0.10001044
-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc
-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++
-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring done
-- Generating done
-- Build files have been written to: /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/geo2json
```

+ æ‰§è¡Œmake

```bash
make -C ./code/create_cmdline_tool/geo2json/
```

```txt
[35m[1mScanning dependencies of target geo2json[0m
[ 50%] [32mBuilding C object CMakeFiles/geo2json.dir/source/src/geo2json.c.o[0m
[1m/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/geo2json/source/src/geo2json.c:9:56: [0m[0;1;35mwarning: [0m[1m
        format specifies type 'char *' but the argument has type 'char (*)[80]'
        [-Wformat][0m
    while (scanf("%f,%f,%79[^\n]",&latitude,&longitude,&info) == 3){
[0;1;32m                        ~~~~~~                         ^~~~~
[0m1 warning generated.
[100%] [32m[1mLinking C executable build/bin/geo2json[0m
[100%] Built target geo2json

```
+ æµ‹è¯•æ‰§è¡Œç¨‹åº

```bash
./code/create_cmdline_tool/geo2json/build/bin/geo2json \
< ./code/create_cmdline_tool/geo2json/data/gpsdata.csv \
> ./code/create_cmdline_tool/geo2json/out/gpsdata.json
```

+ æŸ¥çœ‹ç»“æœ
```bash
cat ./code/create_cmdline_tool/geo2json/out/gpsdata.json
```

```txt
    data=[
    {latitude: 42.363400, longitude: -71.098465, info: 'Speed = 21'},
    {latitude: 42.363327, longitude: -71.097588, info: 'Speed = 23'},
    {latitude: 42.363255, longitude: -71.096710, info: 'Speed = 17'},
    {latitude: 42.363182, longitude: -71.095833, info: 'Speed = 22'},
    {latitude: 42.363110, longitude: -71.094955, info: 'Speed = 14'},
    {latitude: 42.363037, longitude: -71.094078, info: 'Speed = 16'},
    {latitude: 42.362965, longitude: -71.093201, info: 'Speed = 18'},
    {latitude: 42.362892, longitude: -71.092323, info: 'Speed = 22'},
    {latitude: 42.362820, longitude: -71.091446, info: 'Speed = 17'},
    {latitude: 42.362747, longitude: -71.090569, info: 'Speed = 23'},
    {latitude: 42.362675, longitude: -71.089691, info: 'Speed = 14'},
    {latitude: 42.362602, longitude: -71.088814, info: 'Speed = 19'},
    {latitude: 42.362530, longitude: -71.087936, info: 'Speed = 16'},
    {latitude: 42.362457, longitude: -71.087059, info: 'Speed = 16'},
    {latitude: 423.623840, longitude: -71.086182, info: 'Speed = 21'}
    ]
```

### æ•°æ®éªŒè¯

ä¸éš¾å‘ç°,è¾“å…¥æ•°æ®ä¸­æœ‰é”™è¯¯æ•°æ®,æˆ‘ä»¬çš„ç¨‹åºè¦åŠ å…¥ä¸€äº›éªŒè¯é€»è¾‘æ¥è¿›è¡Œé”™è¯¯æ£€éªŒ,å½“ç„¶äº†,é”™è¯¯ä¿¡æ¯åº”è¯¥è¾“å‡ºåœ¨stderré‡Œ


+ `./code/create_cmdline_tool/geo2json/source/src/geo2json.c`

    ```c
    #include <stdio.h>

    int main(){
        float latitude;
        float longitude;
        char info[80];
        int started = 0;
        puts("data=[");
        while (scanf("%f,%f,%79[^\n]",&latitude,&longitude,&info) == 3){
            if (started){
                printf(",\n");
            } else {
                started = 1;
            }
            
            if ((latitude < -90.0) || (latitude > 90.0)) {
                fprintf(stderr,"Invalid latitude: %f\n", latitude);
                continue;
            }
            if ((longitude < -180.0) || (longitude > 180.0)) {
                fprintf(stderr, "Invalid longitude: %f\n", longitude);
                continue;
            }
            
            printf("{latitude: %f, longitude: %f, info: '%s'}",latitude,longitude,info);
        }
        puts("\n]");
        return 0;
    }
    ```

+ æ‰§è¡Œmakeæ“ä½œ

```bash
make -C ./code/create_cmdline_tool/geo2json/
```

```txt
[35m[1mScanning dependencies of target geo2json[0m
[ 50%] [32mBuilding C object CMakeFiles/geo2json.dir/source/src/geo2json.c.o[0m
[1m/Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/geo2json/source/src/geo2json.c:9:56: [0m[0;1;35mwarning: [0m[1m
        format specifies type 'char *' but the argument has type 'char (*)[80]'
        [-Wformat][0m
    while (scanf("%f,%f,%79[^\n]",&latitude,&longitude,&info) == 3){
[0;1;32m                        ~~~~~~                         ^~~~~
[0m1 warning generated.
[100%] [32m[1mLinking C executable build/bin/geo2json[0m
[100%] Built target geo2json

```

+ ç¼–è¯‘ç¨‹åº

```bash
./code/create_cmdline_tool/geo2json/build/bin/geo2json \
< ./code/create_cmdline_tool/geo2json/data/gpsdata.csv \
> ./code/create_cmdline_tool/geo2json/out/gpsdata.json
```

```txt
Invalid latitude: 423.623840
```

+ æŸ¥çœ‹ç»“æœ
```bash
cat ./code/create_cmdline_tool/geo2json/out/gpsdata.json
```

```txt
    data=[
    {latitude: 42.363400, longitude: -71.098465, info: 'Speed = 21'},
    {latitude: 42.363327, longitude: -71.097588, info: 'Speed = 23'},
    {latitude: 42.363255, longitude: -71.096710, info: 'Speed = 17'},
    {latitude: 42.363182, longitude: -71.095833, info: 'Speed = 22'},
    {latitude: 42.363110, longitude: -71.094955, info: 'Speed = 14'},
    {latitude: 42.363037, longitude: -71.094078, info: 'Speed = 16'},
    {latitude: 42.362965, longitude: -71.093201, info: 'Speed = 18'},
    {latitude: 42.362892, longitude: -71.092323, info: 'Speed = 22'},
    {latitude: 42.362820, longitude: -71.091446, info: 'Speed = 17'},
    {latitude: 42.362747, longitude: -71.090569, info: 'Speed = 23'},
    {latitude: 42.362675, longitude: -71.089691, info: 'Speed = 14'},
    {latitude: 42.362602, longitude: -71.088814, info: 'Speed = 19'},
    {latitude: 42.362530, longitude: -71.087936, info: 'Speed = 16'},
    {latitude: 42.362457, longitude: -71.087059, info: 'Speed = 16'},
    
    ]
```

## ç”¨Cæ„å»ºå¸¦å‚æ•°çš„å‘½ä»¤è¡Œå·¥å…·

`unistd.h`æ˜¯Cè¯­è¨€çš„ä¸€ä¸ªå‡†æ ‡å‡†åº“,å®ƒæ˜¯linux,mac osxç­‰ç±»unixç³»ç»Ÿçš„è‡ªå¸¦çš„åº“,ä½†windowså¹¶ä¸æ”¯æŒ.è¦åœ¨windowsä¸‹ä½¿ç”¨éœ€è¦è‡ªå·±å†™ä¸€ä¸ªå¤´æ–‡ä»¶,å¦‚ä¸‹:

```c
/** This file is part of the Mingw32 package. 
*  unistd.h maps     (roughly) to io.h 
*/  
#ifndef _UNISTD_H  
#define _UNISTD_H  
#include <io.h>  
#include <process.h>  
#endif /* _UNISTD_H */ 

```

ä½¿ç”¨å®ƒä¾¿åˆ©çš„æ„å»ºå‘½ä»¤è¡Œå·¥å…·`getopt`

`getopt()`ç”¨æ¥åˆ†æå‘½ä»¤è¡Œå‚æ•°.å‚æ•°`argc`å’Œ`argv`æ˜¯ç”±`main()`ä¼ é€’çš„å‚æ•°ä¸ªæ•°å’Œå†…å®¹.å‚æ•°`optstring`åˆ™ä»£è¡¨æ¬²å¤„ç†çš„é€‰é¡¹å­—ç¬¦ä¸².æ­¤å‡½æ•°ä¼šè¿”å›åœ¨`argv`ä¸­ä¸‹ä¸€ä¸ªçš„é€‰é¡¹å­—æ¯,æ­¤å­—æ¯ä¼šå¯¹åº”å‚æ•°`optstring`ä¸­çš„å­—æ¯.å¦‚æœé€‰é¡¹å­—ç¬¦ä¸²é‡Œçš„å­—æ¯åæ¥ç€å†’å·":".åˆ™è¡¨ç¤ºè¿˜æœ‰ç›¸å…³çš„å‚æ•°,å…¨åŸŸå˜é‡`optarg` å³ä¼šæŒ‡å‘æ­¤é¢å¤–å‚æ•°.å¦‚æœ`getopt()`æ‰¾ä¸åˆ°ç¬¦åˆçš„å‚æ•°åˆ™ä¼šå°å‡ºé”™ä¿¡æ¯,å¹¶å°†å…¨åŸŸå˜é‡`optopt`è®¾ä¸º"?"å­—ç¬¦,å¦‚æœä¸å¸Œæœ›`getopt()`å°å‡ºé”™ä¿¡æ¯,åˆ™åªè¦å°†å…¨åŸŸå˜é‡`opterr`è®¾ä¸º0å³å¯.

### çŸ­å‚æ•°çš„å®šä¹‰

`getopt()`ä½¿ç”¨`optstring`æ‰€æŒ‡çš„å­—ä¸²ä½œä¸ºçŸ­å‚æ•°åˆ—è¡¨,åƒ`"1ac:d::"`å°±æ˜¯ä¸€ä¸ªçŸ­å‚æ•°åˆ—è¡¨.çŸ­å‚æ•°çš„å®šä¹‰æ˜¯ä¸€ä¸ª`'-'`åé¢è·Ÿä¸€ä¸ªå­—æ¯æˆ–æ•°å­—,è±¡`-a`, `-b`å°±æ˜¯ä¸€ä¸ªçŸ­å‚æ•°.æ¯ä¸ªæ•°å­—æˆ–å­—æ¯å®šä¹‰ä¸€ä¸ªå‚æ•°.

å…¶ä¸­çŸ­å‚æ•°åœ¨`getopt`å®šä¹‰é‡Œåˆ†ä¸ºä¸‰ç§ï¼š

+ ä¸å¸¦å€¼çš„å‚æ•°,å®ƒçš„å®šä¹‰å³æ˜¯å‚æ•°æœ¬èº«
+ å¿…é¡»å¸¦å€¼çš„å‚æ•°,å®ƒçš„å®šä¹‰æ˜¯åœ¨å‚æ•°æœ¬èº«åé¢å†åŠ ä¸€ä¸ªå†’å·
+ å¯é€‰å€¼çš„å‚æ•°,å®ƒçš„å®šä¹‰æ˜¯åœ¨å‚æ•°æœ¬èº«åé¢åŠ ä¸¤ä¸ªå†’å·

åœ¨è¿™é‡Œæ‹¿ä¸Šé¢çš„`"1ac:d::"`ä½œä¸ºæ ·ä¾‹è¿›è¡Œè¯´æ˜,å…¶ä¸­çš„
+ `1`,`a`å°±æ˜¯ä¸å¸¦å€¼çš„å‚æ•°
+ `c`æ˜¯å¿…é¡»å¸¦å€¼çš„å‚æ•°
+ `d`æ˜¯å¯é€‰å€¼çš„å‚æ•°

åœ¨å®é™…è°ƒç”¨ä¸­ï¼Œ`'-1 -a -c cvalue -d'`, `'-1 -a -c cvalue -ddvalue'`, `'-1a -ddvalue -c cvalue'`éƒ½æ˜¯åˆæ³•çš„.
è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ç‚¹:

+ ä¸å¸¦å€¼çš„å‚æ•°å¯ä»¥è¿å†™,åƒ`1`å’Œ`a`æ˜¯ä¸å¸¦å€¼çš„å‚æ•°,å®ƒä»¬å¯ä»¥`-1` `-a`åˆ†å¼€å†™,ä¹Ÿå¯ä»¥`-1a`æˆ–`-a1`è¿å†™.
+ å‚æ•°ä¸åˆ†å…ˆåé¡ºåº,`'-1a -c cvalue -ddvalue'`å’Œ`'-d -c cvalue -a1'`çš„è§£æç»“æœæ˜¯ä¸€æ ·çš„.
+ è¦æ³¨æ„å¯é€‰å€¼çš„å‚æ•°çš„å€¼ä¸å‚æ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼,å¿…é¡»å†™æˆ`-ddvalue`è¿™æ ·çš„æ ¼å¼,å¦‚æœå†™æˆ`-d dvalue`è¿™æ ·çš„æ ¼å¼å°±ä¼šè§£æé”™è¯¯.

### è¿”å›å€¼

`getopt()`æ¯æ¬¡è°ƒç”¨ä¼šé€æ¬¡è¿”å›å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°. ã€€ 
+ å½“æ²¡æœ‰å‚æ•°çš„æœ€åçš„ä¸€æ¬¡è°ƒç”¨æ—¶,`getopt()`å°†è¿”å›-1.ã€€ 
+ å½“è§£æåˆ°ä¸€ä¸ªä¸åœ¨`optstring`é‡Œé¢çš„å‚æ•°ï¼Œæˆ–è€…ä¸€ä¸ªå¿…é€‰å€¼å‚æ•°ä¸å¸¦å€¼æ—¶,è¿”å›'?'.ã€€ 
+ å½“`optstring`æ˜¯ä»¥':'å¼€å¤´æ—¶,ç¼ºå€¼å‚æ•°çš„æƒ…å†µä¸‹ä¼šè¿”å›':',è€Œä¸æ˜¯'?'.

+ `./code/create_cmdline_tool/sqrt_opt/source/src/sqrt_opt.c`

    ```c
    #include <stdlib.h>
    #include <stdio.h>
    #include <unistd.h>
    #include <math.h>
    const char * version = "0.1.0";

    int main(int argc, char **argv)  {  
        int ch; 
        double result;
        opterr = 0;
        while ((ch = getopt(argc,argv,"s:v\n"))!=-1){  
            switch(ch){  
                case 'v':
                    printf("option v: %s\n",version);
                    break;  
                case 's':
                    result = sqrt(atoi(optarg));
                    printf("%f\n",result);
                    break;
                default:
                    printf("wrong args\n");
            }  
        }  
        return 0;
    }  
    ```

+ `/code/create_cmdline_tool/sqrt_opt/CMakeLists.txt`

    ```cmake
    #é¡¹ç›®ç¼–è¯‘ç¯å¢ƒ
    cmake_minimum_required (VERSION 2.8)
    project (sqrt_opt)

    # ç¼–è¯‘è¿æ¥ç”Ÿæˆdemo
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/bin)
    aux_source_directory(${CMAKE_BINARY_DIR}/source/src DIR_SRCS)
    add_executable(sqrt_opt ${DIR_SRCS})
    ```


+ æ‰§è¡Œcmake

    ```bash
    cmake ./code/create_cmdline_tool/sqrt_opt/CMakeLists.txt
    ```

    ```txt
    -- Configuring done
    -- Generating done
    -- Build files have been written to: /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/sqrt_opt
    ```

+ æ‰§è¡Œmakeæ“ä½œ

    ```make
    make -C ./code/create_cmdline_tool/sqrt_opt/
    ```

    ```txt
    [35m[1mScanning dependencies of target sqrt_opt[0m
    [ 50%] [32mBuilding C object CMakeFiles/sqrt_opt.dir/source/src/sqrt_opt.c.o[0m
    [100%] [32m[1mLinking C executable build/bin/sqrt_opt[0m
    [100%] Built target sqrt_opt
    ```

+ æµ‹è¯•ç¨‹åº

    ```bash
    ./code/create_cmdline_tool/sqrt_opt/build/bin/sqrt_opt -v
    ```

    ```txt
    option v: 0.1.0
    ```


    ```bash
    !./code/create_cmdline_tool/sqrt_opt/build/bin/sqrt_opt -s36
    ```

    ```txt
    6.000000
    ```

### ä½¿ç”¨cmake test æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·

cmakeè‡ªå¸¦ä¸€ä¸ªå¯ä»¥æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·çš„æ–¹æ¡ˆ,æˆ‘ä»¬æ¥ä¿®æ”¹æˆ‘ä»¬çš„`CMakeLists.txt`,æµ‹è¯•çš„å½¢å¼:

```
add_test (<test_case_name> ${CMAKE_BINARY_DIR}/build/bin/sqrt_opt -s36)
set_tests_properties (<test_case_name>
  PROPERTIES PASS_REGULAR_EXPRESSION "6.0")
```

`add_test`ç”¨äºå¢åŠ ä¸€æ¡æµ‹è¯•,`set_tests_properties`ç”¨äºéªŒè¯æµ‹è¯•æ˜¯å¦ç¬¦åˆé¢„æœŸ.ä½¿ç”¨`PASS_REGULAR_EXPRESSION`åˆ©ç”¨æ­£åˆ™åŒ¹é…æ¥éªŒè¯æ˜¯å¦ç»“æœç¬¦åˆé¢„æœŸ.

+ `./code/create_cmdline_tool/sqrt_opt/CMakeLists.txt`

    ```cmake
    #é¡¹ç›®ç¼–è¯‘ç¯å¢ƒ
    cmake_minimum_required (VERSION 2.8)
    project (sqrt_opt)

    # ç¼–è¯‘è¿æ¥ç”Ÿæˆdemo
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/build/bin)
    aux_source_directory(${CMAKE_BINARY_DIR}/source/src DIR_SRCS)
    add_executable(sqrt_opt ${DIR_SRCS})
    #æµ‹è¯•
    enable_testing()
    add_test (TEST_VERSION ${CMAKE_BINARY_DIR}/build/bin/sqrt_opt -v)
    set_tests_properties (TEST_VERSION
    PROPERTIES PASS_REGULAR_EXPRESSION "v: 0.1.0")
    add_test (TEST_36 ${CMAKE_BINARY_DIR}/build/bin/sqrt_opt -s36)
    set_tests_properties (TEST_36
    PROPERTIES PASS_REGULAR_EXPRESSION "6.0")
    add_test (TEST_2 ${CMAKE_BINARY_DIR}/build/bin/sqrt_opt -s2)
    set_tests_properties (TEST_2
    PROPERTIES PASS_REGULAR_EXPRESSION "1.41")
    ```

+ æ‰§è¡Œcmake

    ```bash
    cmake ./code/create_cmdline_tool/sqrt_opt/CMakeLists.txt
    ```

    ```txt
    -- Configuring done
    -- Generating done
    -- Build files have been written to: /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/sqrt_opt
    ```

+ æ‰§è¡Œmake

    ```bash
    make -C ./code/create_cmdline_tool/sqrt_opt/
    ```

    ```txt
    [100%] Built target sqrt_opt
    ```

    ```bash
    make -C ./code/create_cmdline_tool/sqrt_opt/ test
    ```

    ```txt
    [36mRunning tests...[0m
    Test project /Users/huangsizhe/Workspace/Documents/TutorialForCLang/c-tool-chain/code/create_cmdline_tool/sqrt_opt
        Start 1: TEST_VERSION
    1/3 Test #1: TEST_VERSION .....................   Passed    0.01 sec
        Start 2: TEST_36
    2/3 Test #2: TEST_36 ..........................   Passed    0.01 sec
        Start 3: TEST_2
    3/3 Test #3: TEST_2 ...........................   Passed    0.01 sec
    
    [0;32m100% tests passed[0;0m, 0 tests failed[0;0m out of 3
    
    Total Test time (real) =   0.03 sec
    ```
