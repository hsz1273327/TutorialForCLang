
# æ•°æ®ç±»å‹ä¸å˜é‡å¸¸é‡

## C++ä¸­çš„æ•°æ®ç±»å‹

C++ä¸­çš„æ•°æ®ç±»å‹å¾ˆå°‘,ä½†å¾ˆç¹ç,è®²èµ·æ¥å¾ˆå®¹æ˜“ä¹±å¥—,è¿™è¾¹æœ‰ä¸€å¼ å›¾å¾ˆå¥½çš„æ€»ç»“äº†C++ä¸­çš„æ•°æ®ç±»å‹,é™¤äº†boolå‹å¤–çš„æ•°æ®ç±»å‹éƒ½å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”

![C++è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹](img/Ctypes.jpg)


shortã€intã€longã€charã€floatã€doubleè¿™6ç§è¢«ç§°ä¸ºåŸºæœ¬ç±»å‹,ä»–ä»¬é™¤äº†æ„ä¹‰ä¸åŒç²¾åº¦ä¸åŒ,æ›´åŠ å…³é”®çš„æ˜¯ä»–ä»¬æ‰€å ç”¨çš„å†…å­˜å¤§å°ä¸åŒ.
åœ¨32 ä½çš„ç³»ç»Ÿä¸Š:

+ short åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨2ä¸ªbyteï¼›
+ int åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨4 ä¸ªbyteï¼›
+ long åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨4 ä¸ªbyteï¼›64ä½ç³»ç»Ÿ 8ä¸ªbyte
+ float åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨4 ä¸ªbyteï¼›
+ double åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨8 ä¸ªbyteï¼›
+ char åœ¨32ä½çš„ç³»ç»Ÿä¸Šå ç”¨1 ä¸ªbyteã€‚

é’ˆå¯¹int,long,short,char,è¿˜æœ‰ä¸€ä¸ªä¿®é¥°å…³é”®è¯`unsigned`å¯ä»¥æ”¾åœ¨ä»–ä»¬å‰é¢,è¡¨ç¤ºæ— ç¬¦å·.


å¦å¤–å¤„ç†å¤§æ•°å¯ä»¥ä½¿ç”¨longlongæ•°æ®ç±»å‹,è¡¨ç¤ºä¸€ä¸ª8byteçš„æ•°


### åŸºæœ¬ç±»å‹è½¬æ¢

C++è¯­è¨€çš„ç±»å‹è½¬æ¢ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š

+ è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆéšå¼ç±»å‹è½¬æ¢ï¼Œæœ‰ç¼–è¯‘å™¨å¸®ä½ å»å®Œæˆï¼‰
    
    å¯¹äºè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æ··åˆè¿ç®—ä»¥åŠèµ‹å€¼è¿ç®—ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯å‡½æ•°å€¼çš„ç±»å‹è½¬æ¢
    + èµ‹å€¼è¿ç®—ï¼šè‡ªåŠ¨æŠŠâ€œï¼â€å³è¾¹çš„è¡¨è¾¾å¼çš„ç±»å‹è½¬æ¢æˆâ€œï¼â€å³è¾¹çš„å˜é‡çš„ç±»å‹ï¼Œä¾‹å¦‚ int a=4.5; açš„å€¼å®é™…æ˜¯4ï¼
    + æ··åˆè¿ç®—ï¼šå°±æ˜¯ä¸€ä¸ªè¿ç®—è¡¨è¾¾å¼å½“ä¸­åŒ…å«äº†å¤šä¸ªç±»å‹ï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰ç±»å‹è½¬æ¢ã€‚å½“è¿ç®—ç¬¦ä¸¤è¾¹çš„æ“ä½œæ•°ç±»å‹ä¸åŒæ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°å°±è¦ç»è¿‡ç±»å‹è½¬æ¢ä»¥å’Œå¦ä¸€ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸ä¸€è‡´ï¼Œç„¶åæ‰èƒ½è¿›è¡Œè¿ç®—ã€‚
        å˜æ¢æ“ä½œæ•°é‡‡å–å°±é«˜ä¸å°±ä½çš„åŸåˆ™ï¼Œå³çº§åˆ«ä½çš„æ“ä½œæ•°å…ˆè¢«è½¬æ¢æˆå’Œçº§åˆ«é«˜çš„æ“ä½œæ•°å…·æœ‰åŒä¸€ç±»å‹ï¼Œç„¶åå†è¿›è¡Œè¿ç®—ï¼Œç»“æœçš„æ•°æ®ç±»å‹å’Œçº§åˆ«é«˜çš„æ“ä½œæ•°ç›¸åŒã€‚
           é«˜        double    â†â†    float
           â†‘          â†‘             
           â†‘         long     
           â†‘          â†‘
           â†‘        unsigned
           â†‘          â†‘
           ä½         int      â†â†    char,short

                 è‡ªåŠ¨è½¬æ¢é¡ºåºè¡¨

    + å‡½æ•°è¿”å›å€¼çš„ç±»å‹è½¬æ¢ï¼š int f1(){ return 36.8;}
    
+ å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆä½ çŸ¥é“è‡ªå·±æƒ³è¦ä»€ä¹ˆï¼Œæ‰€ä»¥æ‰è½¬æ¢ï¼‰ã€‚
    å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦
    å¯ä»¥åˆ©ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦å°†ä¸€ä¸ªè¡¨è¾¾å¼è½¬æ¢æˆæ‰€éœ€ç±»å‹:
    ä¾‹å¦‚ï¼š
        (double)a       (å°†aè½¬æ¢æˆdoubleç±»å‹)
        (int)(x+y)      (å°†x+yçš„å€¼è½¬æ¢æˆæ•´å‹)
        (float)(5%3)    (å°†5%3çš„å€¼è½¬æ¢æˆfloatå‹)

    æ³¨æ„ï¼Œè¡¨è¾¾å¼åº”è¯¥ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚å¦‚æœå†™æˆ(int)x+y åˆ™åªå°†xè½¬æ¢æˆæ•´å‹ï¼Œç„¶åä¸yç›¸åŠ ã€‚

## å˜é‡

å’Œpythonä¸­ç±»ä¼¼,C++ä¸­ä¹Ÿæœ‰å˜é‡,å˜é‡çš„å®šä¹‰æ–¹å¼å¦‚ä¸‹:

```c
int a,b,c...;
```

ä¹Ÿå°±æ˜¯

```c
(å­˜å‚¨è¯´æ˜ç¬¦ )æ•°æ®ç±»å‹ å˜é‡å1,å˜é‡å2...;
```

C++è¯­è¨€å’Œpythonä¸åŒçš„æ˜¯pythonçš„å˜é‡ä¸éœ€è¦äº‹å…ˆå£°æ˜,è€ŒC++è¯­è¨€å¿…é¡»äº‹å…ˆå£°æ˜,ä¹ æƒ¯ä¸Šå˜é‡ä¼šåœ¨ä¸€èµ·å£°æ˜,è€Œä¸æ˜¯ä¸œä¸€å—è¥¿ä¸€å—çš„,è¿™æ ·ä¹Ÿæœ‰åŠ©äºdebug.

å­˜å‚¨è¯´æ˜ç¬¦åˆ™æ˜¯å¯¹å˜é‡ç‰¹æ€§çš„å£°æ˜,å¸¸è§çš„å­˜å‚¨è¯´æ˜ç¬¦æœ‰:

+ static 

    é™æ€å±€éƒ¨å˜é‡,æœ‰æ—¶å¸Œæœ›å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡çš„å€¼åœ¨å‡½æ•°è°ƒç”¨ç»“æŸåä¸æ¶ˆå¤±è€Œä¿ç•™åŸå€¼ï¼Œè¿™æ—¶å°±åº”è¯¥æŒ‡å®šå±€éƒ¨å˜é‡ä¸º"é™æ€å±€éƒ¨å˜é‡".å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š 
    + é™æ€å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å®šä¹‰ï¼Œä½†ä¸è±¡è‡ªåŠ¨å˜é‡é‚£æ ·ï¼Œå½“è°ƒç”¨æ—¶å°±å­˜åœ¨ï¼Œé€€å‡ºå‡½æ•°æ—¶å°±æ¶ˆå¤±ã€‚é™æ€å±€éƒ¨å˜é‡å§‹ç»ˆå­˜åœ¨ç€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„ç”Ÿå­˜æœŸä¸ºæ•´ä¸ªæºç¨‹åºã€‚
    + é™æ€å±€éƒ¨å˜é‡çš„ç”Ÿå­˜æœŸè™½ç„¶ä¸ºæ•´ä¸ªæºç¨‹åºï¼Œä½†æ˜¯å…¶ä½œç”¨åŸŸä»ä¸è‡ªåŠ¨å˜é‡ç›¸åŒï¼Œå³åªèƒ½åœ¨å®šä¹‰è¯¥å˜é‡çš„å‡½æ•°å†…ä½¿ç”¨è¯¥å˜é‡ã€‚é€€å‡ºè¯¥å‡½æ•°åï¼Œ å°½ç®¡è¯¥å˜é‡è¿˜ç»§ç»­å­˜åœ¨ï¼Œä½†ä¸èƒ½ä½¿ç”¨å®ƒã€‚
    
    
+ register 

    å¯„å­˜å™¨å˜é‡,ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒC++ è¯­è¨€å…è®¸å°†å±€éƒ¨å˜é‡å¾—å€¼æ”¾åœ¨CPUä¸­çš„å¯„å­˜å™¨ä¸­ï¼Œè¿™ç§å˜é‡å«"å¯„å­˜å™¨å˜é‡"
    
    
+ extern 

    å¤–éƒ¨å˜é‡ï¼ˆå³å…¨å±€å˜é‡ï¼‰æ˜¯åœ¨å‡½æ•°çš„å¤–éƒ¨å®šä¹‰çš„ï¼Œå®ƒçš„ä½œç”¨åŸŸä¸ºä»å˜é‡å®šä¹‰å¤„å¼€å§‹ï¼Œåˆ°æœ¬ç¨‹åºæ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœå¤–éƒ¨å˜é‡ä¸åœ¨æ–‡ä»¶çš„å¼€å¤´å®šä¹‰ï¼Œå…¶æœ‰æ•ˆçš„ä½œç”¨èŒƒå›´åªé™äºå®šä¹‰å¤„åˆ°æ–‡ä»¶ç»ˆäº†ã€‚å¦‚æœåœ¨å®šä¹‰ç‚¹ä¹‹å‰çš„å‡½æ•°æƒ³å¼•ç”¨è¯¥å¤–éƒ¨å˜é‡ï¼Œåˆ™åº”è¯¥åœ¨å¼•ç”¨ä¹‹å‰ç”¨å…³é”®å­— externå¯¹è¯¥å˜é‡ä½œâ€œå¤–éƒ¨å˜é‡å£°æ˜â€ã€‚è¡¨ç¤ºè¯¥å˜é‡æ˜¯ä¸€ä¸ªå·²ç»å®šä¹‰çš„å¤–éƒ¨å˜é‡ã€‚æœ‰äº†æ­¤å£°æ˜ï¼Œå°±å¯ä»¥ä»â€œå£°æ˜â€å¤„èµ·ï¼Œåˆæ³•åœ°ä½¿ç”¨è¯¥å¤–éƒ¨å˜é‡ã€‚


æ€»ç»“ï¼š

>ä»ä½œç”¨åŸŸæ¥åˆ’åˆ†åˆ†ä¸º:
                 
+ å±€éƒ¨å˜é‡

    + é™æ€å±€éƒ¨å˜é‡static(ç¦»å¼€å‡½æ•°ï¼Œå€¼è¿˜ä¿ç•™)
    + å¯„å­˜å™¨å±€éƒ¨å˜é‡register(ç¦»å¼€å‡½æ•°ï¼Œå€¼æ¶ˆå¤±)
    + å½¢å¼å‚æ•°å¯ä»¥å®šä¹‰ä¸ºè‡ªåŠ¨å˜é‡æˆ–è€…registerå˜é‡
             
+ å…¨å±€å˜é‡    

    +  é™æ€å¤–éƒ¨å˜é‡(ä½œç”¨åŸŸåªèƒ½åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ä½œç”¨åŸŸ)
    +  å¤–éƒ¨å˜é‡(éé™æ€å¤–éƒ¨å˜é‡,å…¨å±€å˜é‡ï¼Œå¯ä»¥è¢«å…¶å®ƒæ–‡ä»¶ä½¿ç”¨)

 
>ä»å˜é‡çš„ç”Ÿå­˜å‘¨æœŸæ¥åˆ†ï¼š

+ åŠ¨æ€å­˜å‚¨   

    + å¯„å­˜å™¨å˜é‡register
    + å½¢å¼å‚æ•°
                
+ é™æ€å­˜å‚¨ 

    + é™æ€å±€éƒ¨å˜é‡
    + é™æ€å¤–éƒ¨å˜é‡
    + å¤–éƒ¨å˜é‡(å…¨å±€å˜é‡)

 

> ä»å˜é‡å€¼å­˜æ”¾çš„ä½ç½®ï¼š

+ å†…å­˜ä¸­çš„é™æ€å­˜å‚¨åŒº(å…¨å±€æ•°æ®åŒº)

    + é™æ€å±€éƒ¨å˜é‡
    + é™æ€å¤–éƒ¨å˜é‡
    + å¤–éƒ¨å˜é‡(å…¨å±€å˜é‡)
    

+ å†…å­˜ä¸­çš„åŠ¨æ€å­˜å‚¨åŒº(æ ˆ)

    + å½¢å¼å‚æ•°

+ CPUä¸­çš„å¯„å­˜å™¨ 
    + å¯„å­˜å™¨å˜é‡register


**æ³¨æ„:**å½“å±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡é‡åçš„æ—¶å€™,å’Œpythonä¸€æ ·,ä»¥å±€éƒ¨å˜é‡ä¸ºå‡†,å±è”½å…¨å±€å˜é‡

## å¸¸é‡

å¸¸é‡æ˜¯æŒ‡å€¼ä¸å¯å˜çš„å˜é‡,C++è¯­è¨€ä¸­çš„å¸¸é‡å…¶å®ä¸€ç›´ä»¥æ¥éƒ½è¢«è¯¯è§£,è®°å¾—æˆ‘å­¦Cçš„æ—¶å€™å¸¸é‡å®šä¹‰æ˜¯è¿™æ ·çš„:

```c
#define Pi 3.14
```
å…¶å®è¿™ä¸æ˜¯C++è¯­è¨€çš„å¸¸é‡,è€Œæ˜¯ä½¿ç”¨äº†æ‰€è°“çš„å®,åˆ©ç”¨å®æŠŠ3.14æ›¿æ¢äº†Piè€Œå·²,ä½ è¯´è¿™æ˜¯å¸¸é‡å§ä¹Ÿç®—,ä½†Cè¯­è¨€å±‚é¢çš„å¸¸é‡å®šä¹‰æ–¹å¼å®é™…ä¸Šæ˜¯è¿™æ ·çš„:
```c
const double Pi = 3.14;
```



Pythonä¸­æ²¡æœ‰å¸¸é‡ä¸€è¯´,æˆ‘ä»¬å°±å†™ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¸‹ä»€ä¹ˆæ˜¯å¸¸é‡


```python
%%writefile src/C2/constant.cpp

#include <stdio.h>

const float Pi = 3.1415;

int main(void){
    int r;
    float s;
    r = 2;
    s = Pi*r*r;
    printf("åŠå¾„2måœ†çš„é¢ç§¯ä¸º:%f\n",s);

    Pi = 3.14;
    printf("Pi=%f\n",Pi);
    return 0;
}

```

    Overwriting src/C2/constant.cpp



```python
!g++-7 -o bin/constant src/C2/constant.cpp
```

    [01m[Ksrc/C2/constant.cpp:[m[K In function '[01m[Kint main()[m[K':
    [01m[Ksrc/C2/constant.cpp:13:10:[m[K [01;31m[Kerror: [m[Kassignment of read-only variable '[01m[KPi[m[K'
         Pi = [01;31m[K3.14[m[K;
              [01;31m[K^~~~[m[K


çœ‹,å¸¸æ•°èµ‹å€¼åå°±æ— æ³•å†æ¬¡èµ‹å€¼,å°†è¿™å¥æ³¨é‡Šæ‰


```python
%%writefile src/C2/constant.cpp

#include <stdio.h>

const float Pi = 3.1415;

int main(void){
    int r;
    float s;
    r = 2;
    s = Pi*r*r;
    printf("åŠå¾„2måœ†çš„é¢ç§¯ä¸º:%f\n",s);

    //Pi = 3.14;
    printf("Pi=%f\n",Pi);
    return 0;
}

```

    Overwriting src/C2/constant.cpp



```python
!g++-7 -o bin/constant src/C2/constant.cpp
```


```python
!bin/constant
```

    åŠå¾„2måœ†çš„é¢ç§¯ä¸º:12.566000
    Pi=3.141500


## ç±»å‹æ¨å¯¼[C++11]

### auto 

`auto`åœ¨C++11ä¸­æ˜¯ç”¨äºç±»å‹æ¨æ–­å…³é”®å­—,`auto`æ˜¯ä¸€ä¸ªç±»å‹çš„å ä½ç¬¦,é€šçŸ¥ç¼–è¯‘å™¨å»æ ¹æ®åˆå§‹åŒ–ä»£ç æ¨æ–­æ‰€å£°æ˜å˜é‡çš„çœŸå®ç±»å‹.å„ç§ä½œç”¨åŸŸå†…å£°æ˜å˜é‡éƒ½å¯ä»¥ç”¨åˆ°å®ƒ.ä¾‹å¦‚,åç©ºé—´ä¸­,ç¨‹åºå—ä¸­,æˆ–æ˜¯forå¾ªç¯çš„åˆå§‹åŒ–è¯­å¥ä¸­.ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åƒscalaä¸­ä¸€æ ·ç›´æ¥ç”¨`var`å®šä¹‰å˜é‡äº†,åªæ˜¯å˜é‡å¿…é¡»åé¢æœ‰èµ‹å€¼,è¿™ç‚¹å¯¹pythoneræ¥è¯´ç®€ç›´å°±æ˜¯å¿…é¡»çš„.

`auto`åœ¨C++14ä¸­å¾—åˆ°äº†åŠ å¼º,ç°åœ¨å®ƒå¯ä»¥æ¨å¯¼å‚æ•°ä¹Ÿå¯ä»¥æ¨å¯¼è¿”å›å€¼.


```python
%%writefile src/C2/auto_test.cpp
#include <iostream>
#include <vector>
#include <math.h>
using std::cout;
using std::endl;
using std::vector;

auto quadratic_sum(vector<int> &list){
    auto sum=0;
    auto quadratic = [](auto x){return pow(x,2);};

    for(auto i :list){
        sum += quadratic(i);
    }
    return sum;
}

int main(){
    vector<int> val = {1,2,3,4,5};
    cout<< quadratic_sum(val) <<endl;
    return 0;
}
```

    Overwriting src/C2/auto_test.cpp



```python
!g++-7 -o bin/auto_test src/C2/auto_test.cpp
```


```python
!bin/auto_test
```

    55


### decltype

decltypeå¯ä»¥è¯´æ˜¯autoçš„åä¹‰,å®ƒçš„ä½œç”¨æ˜¯å¯ä»¥æ ¹æ®å˜é‡æ¨æ–­ç±»å‹æ¥å£°æ˜,æ¯”å¦‚æˆ‘ä»¬ä¸çŸ¥é“açš„ç±»å‹,ä½†æˆ‘ä»¬æƒ³è®©bå’Œaç±»å‹ç›¸åŒå±€å¯ä»¥ä½¿ç”¨

```C++
auto x = 3;  
decltype(x) y; 
```
